// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
import { mergeStyles, Stack } from '@fluentui/react';
import { ErrorBar, MessageThread, SendBox, TypingIndicator } from "../../../../react-components/src";
import React, { useCallback, useEffect } from 'react';
import { AvatarPersona } from '../common/AvatarPersona';
import { useAdapter } from './adapter/ChatAdapterProvider';
import { ChatHeader, getHeaderProps } from './ChatHeader';
import { useAdaptedSelector } from './hooks/useAdaptedSelector';
import { usePropsFor } from './hooks/usePropsFor';
import { chatArea, chatContainer, chatWrapper, participantListContainerPadding, messageThreadChatCompositeStyles, sendBoxChatCompositeStyles, typingIndicatorChatCompositeStyles, typingIndicatorContainerStyles } from './styles/Chat.styles';
/**
 * @private
 */
export const ChatScreen = (props) => {
    const { onFetchAvatarPersonaData, onRenderMessage, onRenderTypingIndicator, 
    // onFetchParticipantMenuItems,  // Removed for GA release
    options, styles } = props;
    const defaultNumberOfChatMessagesToReload = 5;
    const sendBoxParentStyle = mergeStyles({ width: '100%' });
    const adapter = useAdapter();
    useEffect(() => {
        adapter.fetchInitialData();
    }, [adapter]);
    const messageThreadProps = usePropsFor(MessageThread);
    const sendBoxProps = usePropsFor(SendBox);
    const typingIndicatorProps = usePropsFor(TypingIndicator);
    const headerProps = useAdaptedSelector(getHeaderProps);
    const errorBarProps = usePropsFor(ErrorBar);
    const onRenderAvatarCallback = useCallback((userId, defaultOptions) => {
        return (React.createElement(AvatarPersona, Object.assign({ userId: userId, hidePersonaDetails: true }, defaultOptions, { dataProvider: onFetchAvatarPersonaData })));
    }, [onFetchAvatarPersonaData]);
    const sendBoxStyles = Object.assign({}, sendBoxChatCompositeStyles, styles === null || styles === void 0 ? void 0 : styles.sendBox);
    const messageThreadStyles = Object.assign({}, messageThreadChatCompositeStyles, styles === null || styles === void 0 ? void 0 : styles.messageThread);
    const typingIndicatorStyles = Object.assign({}, typingIndicatorChatCompositeStyles, styles === null || styles === void 0 ? void 0 : styles.typingIndicator);
    return (React.createElement(Stack, { className: chatContainer, grow: true },
        (options === null || options === void 0 ? void 0 : options.topic) !== false && React.createElement(ChatHeader, Object.assign({}, headerProps)),
        React.createElement(Stack, { className: chatArea, tokens: participantListContainerPadding, horizontal: true, grow: true },
            React.createElement(Stack, { className: chatWrapper, grow: true },
                (options === null || options === void 0 ? void 0 : options.errorBar) !== false && React.createElement(ErrorBar, Object.assign({}, errorBarProps)),
                React.createElement(MessageThread, Object.assign({}, messageThreadProps, { onRenderAvatar: onRenderAvatarCallback, onRenderMessage: onRenderMessage, numberOfChatMessagesToReload: defaultNumberOfChatMessagesToReload, styles: messageThreadStyles })),
                React.createElement(Stack, { className: sendBoxParentStyle },
                    React.createElement("div", { className: mergeStyles(typingIndicatorContainerStyles) }, onRenderTypingIndicator ? (onRenderTypingIndicator(typingIndicatorProps.typingUsers)) : (React.createElement(TypingIndicator, Object.assign({}, typingIndicatorProps, { styles: typingIndicatorStyles })))),
                    React.createElement(SendBox, Object.assign({}, sendBoxProps, { styles: sendBoxStyles })))))));
};
//# sourceMappingURL=ChatScreen.js.map